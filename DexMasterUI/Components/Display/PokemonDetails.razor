@using DexMasterLibrary.Enums

@if (Pokemon.Key != null && Pokemon.Value != null)
{
    <MudContainer MaxWidth="MaxWidth.Large">
        <MudGrid Spacing="2" Justify="Justify.SpaceEvenly">
                <MudItem lg="12">
                    <VersionPicker SelectedVersionChanged="SetVersion"></VersionPicker>
                </MudItem>
            <MudItem lg="12">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudText Typo="Typo.h2">@_pokemonInfo.Name</MudText>
                </MudPaper>
            </MudItem>
            <MudItem lg="6">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudStack>
                        <MudText Typo="Typo.caption">Type 1</MudText>
                        <MudText Typo="Typo.h3">@_pokemonInfo.Type1</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem lg="6">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudStack>
                        <MudText Typo="Typo.caption">Type 2</MudText>
                        <MudText Typo="Typo.h3">@_pokemonInfo.Type2</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem lg="12">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudImage Src="@Pokemon.Key.Sprites.FrontDefault" Width="20"/>
                </MudPaper>
            </MudItem>
            <MudItem lg="6">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudStack>
                        <MudText Typo="Typo.caption">Height</MudText>
                        <MudText Typo="Typo.h6">@_pokemonInfo.Height</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem lg="6">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudStack>
                        <MudText Typo="Typo.caption">Weight</MudText>
                        <MudText Typo="Typo.h6">@_pokemonInfo.Weight</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem lg="12">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-2">
                    <MudStack>
                        <MudText Typo="Typo.caption">Dex Entry</MudText>
                        <MudText Typo="Typo.body1">@_pokemonInfo.FlavourText</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudContainer>
    
    @if (SelectedVersion != null)
    {
        <MudText>You selected @SelectedVersion</MudText>
    }
}

@code {
    [Parameter] 
    public KeyValuePair<Pokemon, PokemonSpecies> Pokemon { get; set; }

    [CascadingParameter] 
    public User LoggedInUser { get; set; }

    private string SelectedVersion { get; set; }

    private PokemonInfo _pokemonInfo = new();

    private class PokemonInfo
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Height { get; set; }
        public string Weight { get; set; }
        public List<PokemonAbility> Abilities { get; set; }
        public Types Type1 { get; set; }
        public Types? Type2 { get; set; }
        public string MainSprite { get; set; }
        public string FlavourText { get; set; }
    }
    
    protected override async Task OnParametersSetAsync()
    {
        if (Pokemon.Key != null && Pokemon.Value != null)
        {
            _pokemonInfo.Id = Pokemon.Key.Id;
            _pokemonInfo.Name = CommonFunctions.Capitalise(Pokemon.Key.Name);
            _pokemonInfo.Height = Pokemon.Key.Height.ToString() + "cm";
            _pokemonInfo.Weight = Pokemon.Key.Weight.ToString() + "g";
            _pokemonInfo.Abilities = Pokemon.Key.Abilities;
            _pokemonInfo.Type1 = CommonFunctions.ConvertStringToEnum<Types>(Pokemon.Key.Types[0].Type.Name).GetValueOrDefault();
            _pokemonInfo.Type2 = Pokemon.Key.Types.Count > 1 ? CommonFunctions.ConvertStringToEnum<Types>(Pokemon.Key.Types[1].Type.Name).GetValueOrDefault() : null;
            _pokemonInfo.MainSprite = Pokemon.Key.Sprites.Other.OfficialArtwork.FrontDefault;
            _pokemonInfo.FlavourText = Pokemon.Value.FlavorTextEntries.FirstOrDefault(x => x.Language.Name == "en").FlavorText;
        }
    }

    private void SetVersion(string version)
    {
        SelectedVersion = version;
    }
}