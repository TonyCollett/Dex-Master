@page "/admin"
@using DexMasterLibrary.Enums

<MudOverlay @bind-Visible="_showLoadingArt" DarkBackground="true" ZIndex="9999" AutoClose="true">
     <MudProgressCircular Color="Color.Secondary" Indeterminate="true" />
</MudOverlay>

<MudGrid>
    <MudItem lg="2">
        <MudButton Variant="Variant.Outlined" Color="Color.Primary" @onclick="GenerateRandomUsers">
            Generate Sample Random User Data
        </MudButton>
    </MudItem>
    <MudItem lg="2">
        <MudButton Variant="Variant.Outlined" Color="Color.Secondary" @onclick="ImportInitialPokemonDataAsync">
            Import Pokemon Data
        </MudButton>
    </MudItem>
    <MudItem lg="2">
        <MudButton Variant="Variant.Outlined" Color="Color.Secondary" @onclick="ImportInitialPokemonSpeciesDataAsync">
            Import Pokemon Species Data
        </MudButton>
    </MudItem>
    <MudText>Completed: @_pokedexNumber</MudText>
</MudGrid>


@code {

    private bool _showLoadingArt;
    private int _pokedexNumber = 0;

    private async Task GenerateRandomUsers()
    {
        _showLoadingArt = true;
        StateHasChanged();

        var fakeUsers = new Faker<User>()
            .RuleFor(u => u.Username, f => f.Person.Random.Words(1));

        await userData.CreateMultipleUsersAsync(fakeUsers.Generate(15));

        _showLoadingArt = false;
        StateHasChanged();
    }

    private async Task ImportInitialPokemonDataAsync()
    {
        _showLoadingArt = true;
        _pokedexNumber = 0;
        int lookup = 50;

        while (_pokedexNumber < 1017)
        {
            IEnumerable<Pokemon> pokemonList = await pokeApiService.GetPokemonListAsync(lookup, _pokedexNumber);
            
            IEnumerable<BasicPokemon> basicPokemonList = pokemonList.Select(p => new BasicPokemon
            {
                Name = CommonFunctions.Capitalise(p.Name),
                NationalDexNumber = p.Id,
                BasicImageSpriteUrl = p.Sprites.FrontDefault,
                Type1 = CommonFunctions.ConvertStringToEnum<Types>(p.Types[0].Type.Name).GetValueOrDefault(),
                Type2 = p.Types.Count > 1 ? CommonFunctions.ConvertStringToEnum<Types>(p.Types[1].Type.Name) : null
            });
            
            await basicPokemonData.CreateMultipleBasicPokemonAsync(basicPokemonList);
            await pokemonData.CreateMultiplePokemonAsync(pokemonList);
            
            _pokedexNumber += lookup;
        }

        _showLoadingArt = false;
        StateHasChanged();
    }
    
    private async Task ImportInitialPokemonSpeciesDataAsync()
    {
        _showLoadingArt = true;
        _pokedexNumber = 0;
        int lookup = 50;

        while (_pokedexNumber < 1017)
        {
            IEnumerable<PokemonSpecies> pokemonSpeciesList = await pokeApiService.GetPokemonSpeciesListAsync(lookup, _pokedexNumber);

            await pokemonSpeciesData.CreateMultiplePokemonSpeciesAsync(pokemonSpeciesList);
            
            _pokedexNumber += lookup;
        }

        _showLoadingArt = false;
        StateHasChanged();
    }
}